<!DOCTYPE html>
<html class="responsive">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="cache-control" content="no-cache, must-revalidate, post-check=0, pre-check=0" />
  <meta http-equiv="cache-control" content="max-age=0" />
  <meta http-equiv="expires" content="0" />
  <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
  <meta http-equiv="pragma" content="no-cache" />


  <title>Spring Cloud Streams</title>
  <meta name="description" content="This tutorial will introduce you to the fundamentals of using Spring Cloud Streams with the Solace PubSub+ Binder. You will create a Source (sending app), a ...">
  <link rel="icon" href="/solace-samples-spring/template/images/solace-favicon.png " type="image/x-icon">
  
  <!-- Required files for solace cloud style -->

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-3921398-9"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-3921398-9');
</script>

<link rel="stylesheet" href="/solace-samples-spring/template/css/materialize.min.css">
<link rel="stylesheet" href="/solace-samples-spring/template/css/solace-common.css">

<!-- google webfont font replacement -->
<link rel='stylesheet' id='avia-google-webfont' href='//fonts.googleapis.com/css?family=Quicksand%7COpen+Sans:400,600' type='text/css' media='all'/>


  
  

</head>

<!-- Required files for solace cloud style -->

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-3921398-9"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-3921398-9');
</script>

<link rel="stylesheet" href="/solace-samples-spring/template/css/materialize.min.css">
<link rel="stylesheet" href="/solace-samples-spring/template/css/solace-common.css">

<!-- google webfont font replacement -->
<link rel='stylesheet' id='avia-google-webfont' href='//fonts.googleapis.com/css?family=Quicksand%7COpen+Sans:400,600' type='text/css' media='all'/>



<body id="top" class="wrap wider">

    <div id='wrap_all'>
    <div class="header-container">
        <header id="header" role="banner" itemscope="itemscope">
          <span class="logo">
            <a href="/">
              <img src="/solace-samples-spring/template/images/solace-logo-white.png" alt="Solace PubSub+ Cloud" width="140px">
            </a>
          </span>
          <nav class="menu" data-selectname="Select a page" role="navigation" itemscope="itemscope" itemtype="https://schema.org/SiteNavigationElement">
            <ul id="header-menu-list" class="menu-list">
              <!--
              <li id="menu-toggle" class="menu-toggle">
                  <i class="fa fa-bars"></i>
              </li>
              -->
              <li id="menu-features" class="menu-item menu-item-underline">
                <a href="/features/" itemprop="url">Features</a>
              </li>
              <li id="header-menu-pricing" class="menu-item menu-item-underline">
                <a href="/pricing/" itemprop="url">Pricing</a>
              </li>
              <li id="header-menu-learn" class="menu-item menu-item-underline">
                <a href="/learn/" itemprop="url">Learn</a>
              </li>
              <li id="header-menu-sales" class="menu-item menu-item-underline">
                <a href="/contact-us/" itemprop="url">Talk to Sales</a>
              </li>
              <li id="header-menu-signup" class="menu-item menu-item-highlight">
                <a href="https://solace.com/try-it-now/" itemprop="url">Try PubSub+</a>
              </li>
              <li id="header-menu-login" class="menu-item menu-item-underline">
                <a href="https://console.solace.cloud/login/" itemprop="url">Log In</a>
              </li>
            </ul>
          </nav>
        </header>
    </div>
</div>


    <section class="docs">
  <div class="container">
    <div class="article-container solace-cloud-padding">
      <article style="padding:10px 30px 30px 30px;">
        <div class="heading solace-cloud-space">
          <img src="/solace-samples-spring/assets/images/spring-cloud.svg" alt="Spring Cloud Streams" />
          <h1>Spring Cloud Streams</h1>
        </div>
        <p>This tutorial will introduce you to the fundamentals of using Spring Cloud Streams with the Solace PubSub+ Binder. You will create a Source (sending app), a Sink (receiving app), and a Processor (combination of a source &amp; a sink). The apps will exchange events using a PubSub+ Event Broker</p>

<h2 id="assumptions">Assumptions</h2>

<p>This tutorial assumes the following:</p>

<ul>
  <li>You are somewhat familiar with Java</li>
  <li>You have Maven 3.5.3 or higher (ensure it’s on your PATH) <a href="https://maven.apache.org/install.html">Install steps here</a></li>
  <li>You have JDK 1.8 (ensure your PATH &amp; JAVA_HOME are updated as needed)</li>
  <li>You have access to Solace messaging with the following configuration details:
    <ul>
      <li>Connectivity information for a Solace message-VPN</li>
      <li>Enabled client username and password</li>
    </ul>
  </li>
</ul>

<p>One simple way to get access to Solace messaging quickly is to create a messaging service in Solace Cloud <a href="//cloud.solace.com/create-messaging-service/" target="_top">as outlined here</a>. You can find other ways to get access to Solace messaging below.</p>

<h2 id="goals">Goals</h2>

<p>The goal of this tutorial is to demonstrate the use of Spring Cloud Streams with the Solace PubSub+ Binder. This tutorial will show you:</p>

<ul>
  <li>How to create a Spring Cloud Streams Source (sending app) to send events into PubSub+</li>
  <li>How to create a Spring Cloud Streams Sink (receiving app) to receive events from PubSub+</li>
  <li>How to create a Spring Cloud Streams Processor (sending &amp; receiving app) to process events using PubSub+</li>
</ul>

<h2 id="spring-cloud-streams-scs-introduction">Spring Cloud Streams (SCS) Introduction</h2>

<p>“Spring Cloud Stream is a framework for building highly scalable event-driven microservices connected with shared messaging systems.”
It is based on Spring Boot, Spring Cloud, Spring Integration and Spring Messaging
Solace PubSub+ is a partner maintained binder implementation for Spring Cloud Streams.</p>
<ol>
  <li>Spring Cloud Stream Project Home: <a href="https://spring.io/projects/spring-cloud-stream" target="_blank">https://spring.io/projects/spring-cloud-stream</a></li>
  <li>The Reference Guide for that current version is available <a href="https://docs.spring.io/spring-cloud-stream/docs/current/reference/htmlsingle" target="_blank">here</a></li>
  <li>PubSub+ Binder <a href="https://github.com/SolaceProducts/spring-cloud-stream-binder-solace" target="_blank">https://github.com/SolaceProducts/spring-cloud-stream-binder-solace</a></li>
</ol>

<h2 id="get-solace-messaging">Get Solace Messaging</h2>

<p>This tutorial requires access Solace messaging and requires that you know several connectivity properties about your Solace messaging. Specifically you need to know the following:</p>

<table>
  <tr>
    <th>Resource</th>
    <th>Value</th>
    <th>Description</th>
  </tr>
  <tr>
    <td>Host</td>
    <td>String</td>
    <td>This is the address clients use when connecting to the Solace messaging to send and receive messages. (Format: <code>DNS_NAME:Port</code> or <code>IP:Port</code>)</td>
  </tr>
  <tr>
    <td>Client Username</td>
    <td>String</td>
    <td>The client username. (See Notes below)</td>
  </tr>
  <tr>
    <td>Client Password</td>
    <td>String</td>
    <td>The client password. (See Notes below)</td>
  </tr>
</table>

<p>There are several ways you can get access to Solace Messaging and find these required properties.</p>

<h3 id="option-1-use-solace-cloud">Option 1: Use Solace Cloud</h3>

<ul>
  <li>Follow <a href="//cloud.solace.com/create-messaging-service/" target="_top">these instructions</a> to quickly spin up a cloud-based Solace messaging service for your applications.</li>
  <li>The messaging connectivity information is found in the service details in the connectivity tab (shown below). You will need:
    <ul>
      <li>Host:Port (use the MQTT URI)</li>
      <li>Client Username</li>
      <li>Client Password</li>
    </ul>
  </li>
</ul>

<p><img src="/solace-samples-spring/assets/images/connectivity-info.png" alt="" /></p>

<h3 id="option-2-start-a-solace-pubsub-software-instance">Option 2: Start a Solace PubSub+ Software Instance</h3>

<ul>
  <li>Follow <a href="//solace.com/software/getting-started/" target="_top">these instructions</a> to start up a PubSub+ Instance using docker.</li>
  <li>If you just setup your instance the default messaging connectivity information will be the following:
    <ul>
      <li>Host: tcp://localhost:55555</li>
      <li>Client Username: default</li>
      <li>Client Password: default</li>
    </ul>

    <p>Note: By default, the Solace VMR “default” message VPN has authentication disabled.</p>
  </li>
</ul>

<h3 id="option-3-get-access-to-a-solace-appliance">Option 3: Get access to a Solace appliance</h3>

<ul>
  <li>Contact your Solace appliance administrators and obtain the following:
    <ul>
      <li>A Solace Message-VPN where you can produce and consume direct and persistent messages</li>
      <li>The host name or IP address of the Solace appliance hosting your Message-VPN</li>
      <li>A username and password to access the Solace appliance</li>
    </ul>
  </li>
</ul>

<h2 id="getting-the-source">Getting the Source</h2>
<p>Clone the GitHub repository containing the Solace samples.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone https://github.com/SolaceSamples/solace-samples-spring
cd solace-samples-spring
</code></pre></div></div>

<h2 id="project-setup">Project Setup</h2>
<p>You should now be in a directory that itself contains multiple directories. 
The following 4 will be used in this tutorial:</p>
<ul>
  <li>cloud-streams-processor</li>
  <li>cloud-streams-sink</li>
  <li>cloud-streams-source</li>
  <li>spring-samples-datamodel</li>
</ul>

<p>The following sections will run the apps from the command line, but if you prefer to use an IDE the projects can be imported as “Maven Projects”</p>

<h3 id="install-the-data-model">Install the data model</h3>
<p>In order to compile/run the actual applications the data model must first be installed to your local maven repo.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd spring-samples-datamodel
mvn clean install
</code></pre></div></div>

<h3 id="analyze-the-maven-dependencies">Analyze the Maven Dependencies</h3>
<p>Using your favorite text editor open the cloud-streams-sink/pom.xml file</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd cloud-streams-sink
vim pom.xml
</code></pre></div></div>

<p>This file defines the dependencies needed for our Sink app to build &amp; run, but they are also the same for our Source and Processor apps. 
Note that the app is actually a Spring Boot Application &amp; is based off the spring-boot-starter-parent.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    &lt;parent&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
            &lt;version&gt;2.1.4.RELEASE&lt;/version&gt;
            &lt;relativePath /&gt; &lt;!-- lookup parent from repository --&gt;
    &lt;/parent&gt;
</code></pre></div></div>

<p>Also note that the dependency below is what enables us to use the Solace PubSub+ Binder.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    &lt;dependency&gt;
            &lt;groupId&gt;com.solace.spring.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-stream-solace&lt;/artifactId&gt;
            &lt;version&gt;1.1.0&lt;/version&gt;
    &lt;/dependency&gt;
</code></pre></div></div>

<h2 id="learn-about-the-sink">Learn about the Sink</h2>
<h3 id="temperaturesinkjava">TemperatureSink.java</h3>
<p>Open the TemperatureSink.java file in the “cloud-streams-sink” project. 
This class shows how simple it is to write a Spring Cloud Streams app that consumes events from PubSub+.</p>

<p>A few things to take note of:</p>
<ul>
  <li>The <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/using-boot-using-springbootapplication-annotation.html">@SpringBootApplication</a> annotation enables auto-configuration and component scanning</li>
  <li>The @EnableBinding(Sink.class) annotation tells us that we are creating a Spring Cloud Streams Sink application and enables the Input channel on the Sink binding interface. This Sink’s input channel will connect to our messaging system at run time.</li>
  <li>The @StreamListener annotation defines which method should be invoked when an event is received on our Sink.INPUT channel.</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@SpringBootApplication</span>
<span class="nd">@EnableBinding</span><span class="o">(</span><span class="n">Sink</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TemperatureSink</span> <span class="o">{</span>
	<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Logger</span> <span class="n">log</span> <span class="o">=</span> <span class="n">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="n">TemperatureSink</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">SpringApplication</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="n">TemperatureSink</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="c1">// We define an INPUT to receive from</span>
	<span class="nd">@StreamListener</span><span class="o">(</span><span class="n">Sink</span><span class="o">.</span><span class="na">INPUT</span><span class="o">)</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">sink</span><span class="o">(</span><span class="n">SensorReading</span> <span class="n">reading</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"Received: "</span> <span class="o">+</span> <span class="n">reading</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="sinkapplicationyml">Sink:application.yml</h3>
<p>Next let’s take a look at the application.yml file. Note that an application.properties file could be used instead. 
Open the application.yml file in the “cloud-streams-sink” project.</p>

<p>A few things to take note of:</p>
<ul>
  <li>The spring.cloud.stream.bindings.input maps to the Sink.INPUT channel for our application.</li>
  <li>Because a “group” is specified we are following the Spring Cloud Streams “Consumer Group” pattern; if a group was not specified the app would be using the Publish-Subscribe pattern.</li>
  <li>Spring Cloud Streams will use the “local_solace” binder since it’s the only one present; if multiple binders are present you can specify the binder on each binding.</li>
  <li>Change your <em>host</em>, <em>msgVpn</em>, <em>clientUsername</em> &amp; <em>clientPassword</em> to match your Solace Messaging Service. The host should be your “SMF URI”.</li>
  <li>Notice the spring.cloud.steams.solace.bindings is where Solace specific configurations can be set; here we see an example where we are telling our queue to subscribe to the “sensor/temperature/&gt;” topic. The “&gt;” sign is a wildcard that allows us to receive any events sent to any topic that starts with “sensor/temperature/” We will be using it to receive events on “sensor/temperature/celsius” and “sensor/temperature/fahrenheit” topics.</li>
</ul>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">spring</span><span class="pi">:</span>
  <span class="na">cloud</span><span class="pi">:</span>
    <span class="na">stream</span><span class="pi">:</span>
      <span class="na">bindings</span><span class="pi">:</span>
        <span class="na">input</span><span class="pi">:</span>
          <span class="na">destination</span><span class="pi">:</span> <span class="s">TEMPS.Q</span>
          <span class="c1">#The presence of "group" tells the binder to follow the "consumer group" pattern</span>
          <span class="na">group</span><span class="pi">:</span> <span class="s">SINK</span>
      <span class="na">binders</span><span class="pi">:</span>
        <span class="na">local_solace</span><span class="pi">:</span>
          <span class="na">type</span><span class="pi">:</span> <span class="s">solace</span>
          <span class="na">environment</span><span class="pi">:</span>
            <span class="na">solace</span><span class="pi">:</span>
              <span class="na">java</span><span class="pi">:</span>
                <span class="na">host</span><span class="pi">:</span> <span class="s">tcp://localhost:55555</span>
                <span class="na">msgVpn</span><span class="pi">:</span> <span class="s">default</span>
                <span class="na">clientUsername</span><span class="pi">:</span> <span class="s">default</span>
                <span class="na">clientPassword</span><span class="pi">:</span> <span class="s">default</span>
      <span class="na">solace</span><span class="pi">:</span>
        <span class="na">bindings</span><span class="pi">:</span>
          <span class="na">input</span><span class="pi">:</span>
            <span class="na">consumer</span><span class="pi">:</span>
              <span class="na">queueAdditionalSubscriptions</span><span class="pi">:</span> <span class="s">sensor/temperature/&gt;</span>
</code></pre></div></div>

<h3 id="sinkrun-the-app">Sink:Run the app</h3>
<p>Now it’s time to run the app.
Run from the command line using maven like seen below</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mvn spring-boot:run
</code></pre></div></div>

<p>You should see the application start; you will know it’s started when the console has a line that contains “Started TemperatureSink in” 
Leave the app running for the remainder of the tutorial &amp; don’t worry that no events are being received yet.</p>

<h2 id="learn-about-the-source">Learn about the Source</h2>

<h3 id="fahrenheittempsourcejava">FahrenheitTempSource.java</h3>
<p>Open a new console/terminal if needed. 
Open the FahrenheitTempSource.java file in the “cloud-streams-source” project. 
This class shows how simple it is to write a Spring Cloud Streams app that sends events to PubSub+.
The class is simulating an event source that emits a temperature, in Fahrenheit, every 5 seconds.</p>

<p>A few things to take note of:</p>
<ul>
  <li>As before the <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/using-boot-using-springbootapplication-annotation.html">@SpringBootApplication</a> annotation enables auto-configuration and component scanning</li>
  <li>The @EnableBinding(Source.class) annotation tells us that we are creating a Spring Cloud Streams Source application and enables the Output channel on the Source binding interface. This Source’s output channel will connect to our messaging system at run time.</li>
  <li>The @InboundChannelAdapter annotation defines which method will be using the Source.OUTPUT channel. It is also enabling us to send a SensorReading event every 5 seconds.</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@SpringBootApplication</span>
<span class="nd">@EnableBinding</span><span class="o">(</span><span class="n">Source</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FahrenheitTempSource</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Logger</span> <span class="n">log</span> <span class="o">=</span> <span class="n">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="n">FahrenheitTempSource</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">UUID</span> <span class="n">sensorIdentifier</span> <span class="o">=</span> <span class="n">UUID</span><span class="o">.</span><span class="na">randomUUID</span><span class="o">();</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Random</span> <span class="n">random</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Random</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">());</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">RANDOM_MULTIPLIER</span> <span class="o">=</span> <span class="mi">100</span><span class="o">;</span>
    

        <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">SpringApplication</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="n">FahrenheitTempSource</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>
        <span class="o">}</span>

    <span class="nd">@InboundChannelAdapter</span><span class="o">(</span><span class="n">channel</span> <span class="o">=</span> <span class="n">Source</span><span class="o">.</span><span class="na">OUTPUT</span><span class="o">,</span> <span class="n">poller</span> <span class="o">=</span> <span class="nd">@Poller</span><span class="o">(</span><span class="n">fixedRate</span> <span class="o">=</span> <span class="s">"5000"</span><span class="o">))</span>
    <span class="kd">public</span> <span class="n">SensorReading</span> <span class="nf">emitSensorReading</span><span class="o">()</span> <span class="o">{</span>
        <span class="kt">double</span> <span class="n">temperature</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="na">nextDouble</span><span class="o">()</span> <span class="o">*</span> <span class="n">RANDOM_MULTIPLIER</span><span class="o">;</span>

        <span class="n">SensorReading</span> <span class="n">reading</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SensorReading</span><span class="o">();</span>
        <span class="n">reading</span><span class="o">.</span><span class="na">setSensorID</span><span class="o">(</span><span class="n">sensorIdentifier</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
        <span class="n">reading</span><span class="o">.</span><span class="na">setTemperature</span><span class="o">(</span><span class="n">temperature</span><span class="o">);</span>
        <span class="n">reading</span><span class="o">.</span><span class="na">setBaseUnit</span><span class="o">(</span><span class="n">BaseUnit</span><span class="o">.</span><span class="na">FAHRENHEIT</span><span class="o">);</span>
        
        <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"Emitting "</span> <span class="o">+</span> <span class="n">reading</span><span class="o">);</span>

        <span class="k">return</span> <span class="n">reading</span><span class="o">;</span>
    <span class="o">}</span>
</code></pre></div></div>

<h3 id="sourceapplicationyml">Source:application.yml</h3>
<p>Next let’s take a look at the application.yml file. As stated earlier, an application.properties file could be used instead. 
Open the application.yml file in the “cloud-streams-source” project.</p>

<p>A few things to take note of:</p>
<ul>
  <li>The spring.cloud.stream.bindings.output maps to the Source.OUTPUT channel for our application; in this example we are sending to the “sensor/temperature/fahrenheit” topic.</li>
  <li>Spring Cloud Streams will use the “local_solace” binder since it’s the only one present; if multiple binders are present you can specify the binder on each binding.</li>
  <li>Change your <em>host</em>, <em>msgVpn</em>, <em>clientUsername</em> &amp; <em>clientPassword</em> to match your Solace Messaging Service. The host should be your “SMF URI”.</li>
</ul>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">spring</span><span class="pi">:</span>
  <span class="na">cloud</span><span class="pi">:</span>
    <span class="na">stream</span><span class="pi">:</span>
      <span class="na">bindings</span><span class="pi">:</span>
        <span class="na">output</span><span class="pi">:</span>
          <span class="na">destination</span><span class="pi">:</span> <span class="s">sensor/temperature/fahrenheit</span>
          <span class="na">binder</span><span class="pi">:</span> <span class="s">local_solace</span>
      <span class="na">binders</span><span class="pi">:</span>
        <span class="na">local_solace</span><span class="pi">:</span>
          <span class="na">type</span><span class="pi">:</span> <span class="s">solace</span>
          <span class="na">environment</span><span class="pi">:</span>
            <span class="na">solace</span><span class="pi">:</span>
              <span class="na">java</span><span class="pi">:</span>
                <span class="na">host</span><span class="pi">:</span> <span class="s">tcp://localhost:55555</span>
                <span class="na">msgVpn</span><span class="pi">:</span> <span class="s">default</span>
                <span class="na">clientUsername</span><span class="pi">:</span> <span class="s">default</span>
                <span class="na">clientPassword</span><span class="pi">:</span> <span class="s">default</span>
</code></pre></div></div>

<h3 id="sourcerun-the-app">Source:Run the app</h3>
<p>Now it’s time to run the app.
Run from the command line using maven like seen below</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mvn spring-boot:run
</code></pre></div></div>

<p>You should see the application start; you will know it’s started when the console has a line that contains “Started FahrenheitTempSource in” 
After starting you should see the Source app emitting an event every 5 seconds. 
Note that if you look back at your Sink app that was deployed previously you should now see it receiving the events that are being emitted.</p>

<p>At this point you have now implemented a sending &amp; receiving app using Spring Cloud Streams and PubSub+ !!
Leave the app running for the remainder of the tutorial.</p>

<h2 id="learn-about-the-processor">Learn about the Processor</h2>

<h3 id="convertftocprocessorjava">ConvertFtoCProcessor.java</h3>
<p>Open a new console/terminal if needed. 
Open the ConvertFtoCProcessor.java file in the “cloud-streams-processor” project. 
This class shows how simple it is to write a Spring Cloud Streams app that receives, processesses &amp; sends to PubSub+.
The class is a processor which receives SensorReadings in Fahrenheit from one topic, converts them to Celsius and publishes the updated SensorReadings to a Celsius topic</p>

<p>A few things to take note of:</p>
<ul>
  <li>As before the <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/using-boot-using-springbootapplication-annotation.html">@SpringBootApplication</a> annotation enables auto-configuration and component scanning</li>
  <li>The @EnableBinding(Processor.class) annotation tells us that we are creating a Spring Cloud Streams Processor application and enables the Input &amp; Output channels on the Processor binding interface. This Prcoessor’s input &amp; output channels will be bound to our messaging system at run time.</li>
  <li>The @StreamListener annotation defines which method should be invoked when an event is received on our Processor.INPUT channel.</li>
  <li>The @SendTo annotation defines that returned objects from the method should be sent to the Processor.OUTPUT channel.</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@SpringBootApplication</span>
<span class="nd">@EnableBinding</span><span class="o">(</span><span class="n">Processor</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ConvertFtoCProcessor</span> <span class="o">{</span>
	
	<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Logger</span> <span class="n">log</span> <span class="o">=</span> <span class="n">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="n">ConvertFtoCProcessor</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
	
	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">SpringApplication</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="n">ConvertFtoCProcessor</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>
	<span class="o">}</span>
	
	<span class="nd">@StreamListener</span><span class="o">(</span><span class="n">Processor</span><span class="o">.</span><span class="na">INPUT</span><span class="o">)</span>
	<span class="nd">@SendTo</span><span class="o">(</span><span class="n">Processor</span><span class="o">.</span><span class="na">OUTPUT</span><span class="o">)</span>
	<span class="kd">public</span> <span class="n">SensorReading</span> <span class="nf">handle</span><span class="o">(</span><span class="n">SensorReading</span> <span class="n">reading</span><span class="o">)</span> <span class="o">{</span>
		
		<span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"Received: "</span> <span class="o">+</span> <span class="n">reading</span><span class="o">);</span>
        
		<span class="kt">double</span> <span class="n">temperatureCelsius</span> <span class="o">=</span> <span class="o">(</span><span class="n">reading</span><span class="o">.</span><span class="na">getTemperature</span><span class="o">().</span><span class="na">doubleValue</span><span class="o">()</span> <span class="o">-</span> <span class="mi">32</span><span class="o">)</span> <span class="o">*</span> <span class="mi">5</span> <span class="o">/</span> <span class="mi">9</span><span class="o">;</span>
                <span class="n">reading</span><span class="o">.</span><span class="na">setTemperature</span><span class="o">(</span><span class="n">temperatureCelsius</span><span class="o">);</span>
                <span class="n">reading</span><span class="o">.</span><span class="na">setBaseUnit</span><span class="o">(</span><span class="n">SensorReading</span><span class="o">.</span><span class="na">BaseUnit</span><span class="o">.</span><span class="na">CELSIUS</span><span class="o">);</span>

		<span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"Sending: "</span> <span class="o">+</span> <span class="n">reading</span><span class="o">);</span>
		<span class="k">return</span> <span class="n">reading</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="processorapplicationyml">Processor:application.yml</h3>
<p>Next let’s take a look at the application.yml file. As stated earlier, an application.properties file could be used instead. 
Open the application.yml file in the “cloud-streams-processor” project.</p>

<p>A few things to take note of:</p>
<ul>
  <li>The spring.cloud.stream.bindings now includes both an “input” and an “output” binding. These maps to our Processor.INPUT &amp; Processor.OUTPUT channels respectively; note that our output destination will be sending to the “sensor/temperature/celsius” topic.</li>
  <li>Spring Cloud Streams will use the “local_solace” binder since it’s the only one present; if multiple binders are present you can specify the binder on each binding.</li>
  <li>Change your <em>host</em>, <em>msgVpn</em>, <em>clientUsername</em> &amp; <em>clientPassword</em> to match your Solace Messaging Service. The host should be your “SMF URI”.</li>
  <li>Notice the spring.cloud.steams.solace.bindings is where Solace specific configurations can be set; here we see an example where we are telling our input bindings queue to subscribe to the “sensor/temperature/fahrenheit” topic.</li>
</ul>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">spring</span><span class="pi">:</span>
  <span class="na">cloud</span><span class="pi">:</span>
    <span class="na">stream</span><span class="pi">:</span>
      <span class="na">default-binder</span><span class="pi">:</span> <span class="s">local_solace</span>
      <span class="na">bindings</span><span class="pi">:</span>
        <span class="na">input</span><span class="pi">:</span>
          <span class="na">destination</span><span class="pi">:</span> <span class="s">TEMPS.Q</span>
          <span class="na">group</span><span class="pi">:</span> <span class="s">PROCESSOR</span>
        <span class="na">output</span><span class="pi">:</span>
          <span class="na">destination</span><span class="pi">:</span> <span class="s">sensor/temperature/celsius</span>
      <span class="na">binders</span><span class="pi">:</span>
        <span class="na">local_solace</span><span class="pi">:</span>
          <span class="na">type</span><span class="pi">:</span> <span class="s">solace</span>
          <span class="na">environment</span><span class="pi">:</span>
            <span class="na">solace</span><span class="pi">:</span>
              <span class="na">java</span><span class="pi">:</span>
                <span class="na">host</span><span class="pi">:</span> <span class="s">tcp://localhost:55555</span>
                <span class="na">msgVpn</span><span class="pi">:</span> <span class="s">default</span>
                <span class="na">clientUsername</span><span class="pi">:</span> <span class="s">default</span>
                <span class="na">clientPassword</span><span class="pi">:</span> <span class="s">default</span>
                <span class="na">connectRetries</span><span class="pi">:</span> <span class="s">-1</span>
                <span class="na">reconnectRetries</span><span class="pi">:</span> <span class="s">-1</span>
      <span class="na">solace</span><span class="pi">:</span>
        <span class="na">bindings</span><span class="pi">:</span>
          <span class="na">input</span><span class="pi">:</span>
            <span class="na">consumer</span><span class="pi">:</span>
              <span class="na">queueAdditionalSubscriptions</span><span class="pi">:</span> <span class="s">sensor/temperature/fahrenheit</span>
</code></pre></div></div>

<h3 id="processorrun-the-app">Processor:Run the app</h3>
<p>Now it’s time to run the app.
Run from the command line using maven like seen below</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mvn spring-boot:run
</code></pre></div></div>

<p>You should see the application start; you will know it’s started when the console has a line that contains “Started ConvertFtoCProcessor in” 
After starting you should see the Processor app start to process the fahrenheit events sent by the Source that is still running from before.</p>

<p>Note that if you look back at your Sink app you should now see it receiving both Fahrenheit &amp; Celsius events. This is because it is subscribed to the “sensor/temperature/&gt;” 
Fahrenheit events are being received from the initial Source app from the “sensor/temperature/fahrenheit” topic and Celsius events are being received from the Processor app from the “sensor/temperature/celsius” topic.</p>

<h2 id="takeaway">Takeaway</h2>
<p>Spring Cloud Streams makes it super simple to develop event-driven microservices &amp; applications! Note that you did not have to learn any messaging APIs in order to use Spring Cloud Streams. It allowed you to create an entire event creation, processing and receiving chain without having to use Messaging/Eventing APIs which allows your to focus on your business goals.</p>


      </article>
      <aside>
        

    <div style="margin-bottom: 25px;">
        <h4 class="navheading"><a href="/solace-samples-spring/">Getting Started</a></h4>
        <ul class="navlist">
              
            <li class="navlink_current"><a href="/solace-samples-spring/spring-cloud-streams/">Spring Cloud Streams</a></li>
              
            <li class="navlink"><a href="/solace-samples-spring/spring-boot-autoconfigure/">Spring Boot Autoconfig (JMS)</a></li>
            
        </ul>
    </div>


    <div>
        
        <ul class="navlist">
            
        </ul>
    </div>

<div class="nav">
    <select name="menu" onchange="top.window.location = this.value">
        <option value="#" selected>Pick Another API</option>
        <optgroup label="Solace APIs">
            
                <option value="//solace.com/samples/solace-samples-c/">C</option>
            
                <option value="//solace.com/samples/solace-samples-dotnet/">C#/.NET</option>
            
                <option value="//solace.com/samples/solace-samples-java/">Java</option>
            
                <option value="//solace.com/samples/solace-samples-javarto/">Java RTO</option>
            
                <option value="//solace.com/samples/solace-samples-javascript/">JavaScript</option>
            
                <option value="//solace.com/samples/solace-samples-nodejs/">Node.js</option>
            
        </optgroup>
        <optgroup label="Open APIs & Protocols">
            
                <option value="//solace.com/samples/solace-samples-amqp-qpid-jms1/">AMQP - JMS 1.1</option>
            
                <option value="//solace.com/samples/solace-samples-amqp-qpid-jms2/">AMQP - JMS 2.0</option>
            
                <option value="//solace.com/samples/solace-samples-amqp-nodejs/">AMQP - Node.js</option>
            
                <option value="//solace.com/samples/solace-samples-mqtt/">MQTT - Eclipse Paho Java</option>
            
                <option value="//solace.com/samples/solace-samples-amqp-qpid-jms1/">JMS 1.1 - Apache Qpid</option>
            
                <option value="//solace.com/samples/solace-samples-amqp-qpid-jms2/">JMS 2.0 - Apache Qpid</option>
            
                <option value="//solace.com/samples/solace-samples-jms/">JMS 1.1 - Solace</option>
            
                <option value="//solace.com/samples/solace-samples-openmama/">OpenMAMA</option>
            
                <option value="//solace.com/samples/solace-samples-rest-messaging/">REST Messaging</option>
            
        </optgroup>
        <optgroup label="Other Environments">
            
                <option value="//solace.com/samples/solace-samples-spring/">Spring Projects</option>
            
                <option value="//docs.pivotal.io/partners/solace-pubsub/">Pivotal Cloud Foundry</option>
            
        </optgroup>
    </select>
</div>
<div class="github">
    <div>
        <img class="grey-image" src="/solace-samples-spring/template/images/hosted-in-github.png" alt="hosted-in-github"
            width="150" height="57"></img>
    </div>
    
    <div class="github-link">
        <img class="fork-icon" src="/solace-samples-spring/template/images/github-icon.png"/>
        <a href="https://github.com/SolaceSamples/solace-samples-spring/blob/master/src/main/java/com/solace/samples/spring/scs/FarhenheitTempSource.java" target="_blank">Source Example</a> <br />
    </div>
    
    <div class="github-link">
        <img class="fork-icon" src="/solace-samples-spring/template/images/github-icon.png"/>
        <a href="https://github.com/SolaceSamples/solace-samples-spring/blob/master/src/main/java/com/solace/samples/spring/scs/TemperatureSink.java" target="_blank">Sink Example</a> <br />
    </div>
    
    <div class="github-link">
        <img class="fork-icon" src="/solace-samples-spring/template/images/github-icon.png"/>
        <a href="https://github.com/SolaceSamples/solace-samples-spring/blob/master/src/main/java/com/solace/samples/spring/scs/ConvertFtoCProcessor.java" target="_blank">Processor Example</a> <br />
    </div>
    
    <div class="github-link">
        <img src="/solace-samples-spring/template/images/pencil-icon.png"/>
        <a href="https://github.com/SolaceSamples/solace-samples-spring/blob/master/docs/_docs/spring-cloud-streams.md" target="_blank">Improve this page</a>
    </div>
    <div class="github-link">
        <img src="/solace-samples-spring/template/images/issue-icon.png"/>
        <a href="https://github.com/SolaceSamples/solace-samples-spring/issues/new" target="_blank">Raise an issue</a>
    </div>
</div>
<!--<script>-->
  <!--function scrollFunction() {-->
      <!--document.querySelector("aside").style.top = this.window.scrollY + 60 + "px";-->
  <!--}-->
  <!--window.onscroll = scrollFunction;-->
<!--</script>-->

      </aside>
    </div>
  </div>
</section>


    
</body>

</html>
